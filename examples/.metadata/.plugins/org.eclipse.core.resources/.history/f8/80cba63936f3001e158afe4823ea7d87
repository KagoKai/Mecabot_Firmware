#include "mecabot_hardware.h"

Motor motor[4];
Encoder encoder[4];

status_t mecabot_motor_init(void)
{
    Motor_Handle_t handle_FL = {
      .pwm_channel = TIM_CHANNEL_1,
	  .direction_port = GPIOA,
	  .direction_pin_A = GPIO_PIN_6,
	  .direction_pin_B = GPIO_PIN_6,
	  .pwm_frequency = 1000
    };
    motor[front_left] = Motor_Init(handle_FL);

    Motor_Handle_t handle_FR = {
	  .pwm_channel = TIM_CHANNEL_2,
	  .direction_port = GPIOA,
	  .direction_pin_A = GPIO_PIN_7,
	  .direction_pin_B = GPIO_PIN_7,
	  .pwm_frequency = 1000
    };
    motor[front_right] = Motor_Init(handle_FR);

    Motor_Handle_t handle_BL = {
	  .pwm_channel = TIM_CHANNEL_3,
	  .direction_port = GPIOB,
	  .direction_pin_A = GPIO_PIN_0,
	  .direction_pin_B = GPIO_PIN_0,
	  .pwm_frequency = 1000
    };
    motor[back_left] = Motor_Init(handle_BL);

    Motor_Handle_t handle_BR = {
	  .pwm_channel = TIM_CHANNEL_4,
	  .direction_port = GPIOB,
	  .direction_pin_A = GPIO_PIN_1,
	  .direction_pin_B = GPIO_PIN_1,
	  .pwm_frequency = 1000
    };
    motor[back_right] = Motor_Init(handle_BR);

    return STATUS_OK;
}

status_t mecabot_encoder_init(void)
{
    Encoder_Handle_t handle_encoder = {
        .max_count = 0xFFFFFFFF,
        .tick_read_channel = TIM_CHANNEL_1
    };
    encoder[front_left] = Encoder_Init(handle_encoder);

    handle_encoder.tick_read_channel = TIM_CHANNEL_2;
    encoder[front_right] = Encoder_Init(handle_encoder);

    handle_encoder.tick_read_channel = TIM_CHANNEL_3;
    encoder[back_left] = Encoder_Init(handle_encoder);
        
    handle_encoder.tick_read_channel = TIM_CHANNEL_4;
	encoder[back_right] = Encoder_Init(handle_encoder);

	return STATUS_OK;
}

status_t mecabot_motor_start(Motor motor);
status_t mecabot_motor_stop(Motor motor);
status_t mecabot_motor_set_speed(Motor motor, float speed);

status_t mecabot_encoder_read(Encoder encoder);
